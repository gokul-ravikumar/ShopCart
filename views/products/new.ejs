<% layout("./boilerplate/boilerplate.ejs") -%>
    <div class="flex flex-col justify-center items-center w-screen h-screen">
        <h2 class="py-2 font-bold text-2xl md:text-3xl">
            Add More Products
            <span class="italic text-3xl md:text-4xl text-orange-600">ShopCart</span>
        </h2>

        <form action="/" method="post" enctype="multipart/form-data" class="w-80 md:w-96">
            <!-- Product Title -->
            <div class="relative z-0 w-full mb-5 group py-2">
                <input type="text" name="product[title]" id="productTitle"
                    class="block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none dark:text-black dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer"
                    placeholder=" " required />
                <label for="productTitle"
                    class="peer-focus:font-medium absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:start-0 peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6">Product
                    Title</label>
            </div>

            <!-- Product Description -->
            <div class="relative z-0 w-full mb-5 group py-2">
                <input type="text" name="product[description]" id="productDescription"
                    class="block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none dark:text-black dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer"
                    placeholder=" " required />
                <label for="productDescription"
                    class="peer-focus:font-medium absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:start-0 peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6">Product
                    Description</label>
            </div>

            <!-- Price & Stock side by side -->
            <div class="grid md:grid-cols-2 md:gap-6">
                <div class="relative z-0 w-full mb-5 group">
                    <input type="number" name="product[price]" id="productPrice"
                        class="block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none dark:text-black dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer"
                        placeholder=" " required />
                    <label for="productPrice"
                        class="peer-focus:font-medium absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:start-0 peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6">Product
                        Price</label>
                </div>

                <div class="relative z-0 w-full mb-5 group">
                    <input type="number" name="product[stock]" id="productStock"
                        class="block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none dark:text-black dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer"
                        placeholder=" " required />
                    <label for="productStock"
                        class="peer-focus:font-medium absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:start-0 peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6">Product
                        Stock</label>
                </div>
            </div>

            <!-- Category -->
            <div class="relative z-0 w-full mb-5 group py-2">
                <input type="text" name="product[category]" id="productCategory"
                    class="block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none dark:text-black dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer"
                    placeholder=" " required />
                <label for="productCategory"
                    class="peer-focus:font-medium absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:start-0 peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6">Category</label>
            </div>

            <!-- Upload multiple images -->
            <div class="relative z-0 w-full mb-5 group py-2">
                <label for="productImages"
                    class="flex items-center justify-center px-4 py-2 bg-black text-white text-sm font-medium rounded-lg cursor-pointer hover:bg-blue-700 transition duration-300">
                    Upload Images
                </label>
                <input type="file" name="product[images][]" id="productImages" class="hidden" multiple accept="image/*"
                    required />
                <p id="file-chosen" class="mt-2 text-sm text-gray-900 font-bold dark:text-gray-400">
                    No files chosen
                </p>

                <!-- Preview container -->
                <div id="image-preview" class="mt-3 grid grid-cols-2 gap-3"></div>
            </div>

            <!-- Submit button -->
            <button type="submit"
                class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-4 py-2 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">
                Submit
            </button>
        </form>
    </div>

    <!-- JS for multiple preview -->
    <script>
        const input = document.getElementById("productImages");
        const fileChosen = document.getElementById("file-chosen");
        const fileCount = document.getElementById("file-count");
        const previewContainer = document.getElementById("image-preview");
        const maxFiles = 5;
        const minFiles = 1;

        input.addEventListener("change", function () {
            previewContainer.innerHTML = ""; // Clear old previews
            const totalFiles = this.files.length;

            // Validate number of files
            if (totalFiles > maxFiles) {
                alert(`You can upload a maximum of ${maxFiles} images.`);
                this.value = "";
                fileChosen.textContent = "No files chosen";
                fileCount.textContent = `0 / ${maxFiles} images selected`;
                return;
            }

            if (totalFiles < minFiles) {
                fileChosen.textContent = "No files chosen";
                fileCount.textContent = `0 / ${maxFiles} images selected`;
                return;
            }

            // Update labels
            const names = Array.from(this.files).map(f => f.name).join(", ");
            fileChosen.textContent = names;
            fileCount.textContent = `${totalFiles} / ${maxFiles} images selected`;

            // Preview thumbnails
            Array.from(this.files).forEach(file => {
                const reader = new FileReader();
                reader.onload = e => {
                    const img = document.createElement("img");
                    img.src = e.target.result;
                    img.className = "w-full h-32 object-cover rounded-xl shadow border border-gray-200";
                    previewContainer.appendChild(img);
                };
                reader.readAsDataURL(file);
            });
        });

        // Double-check before submit
        document.querySelector("form").addEventListener("submit", function (e) {
            if (input.files.length < minFiles) {
                e.preventDefault();
                alert(`Please upload at least ${minFiles} image.`);
            }
        });
    </script>